# Railway éƒ¨ç½²æŒ‡å—

## ðŸš‚ Railway éƒ¨ç½²æ­¥éª¤

### ä¸€ã€å‡†å¤‡å·¥ä½œ

1. **æ³¨å†Œ Railway è´¦å·**
   - è®¿é—® https://railway.app/
   - ä½¿ç”¨ GitHub è´¦å·ç™»å½•ï¼ˆæŽ¨èï¼‰
   - é¦–æ¬¡æ³¨å†ŒèŽ·å¾— $5 å…è´¹é¢åº¦

### äºŒã€éƒ¨ç½²åŽç«¯åˆ° Railway

#### 1. åˆ›å»ºæ–°é¡¹ç›®

åœ¨ Railway Dashboardï¼š
1. ç‚¹å‡» "New Project"
2. é€‰æ‹© "Deploy from GitHub repo"
3. æŽˆæƒ Railway è®¿é—®ä½ çš„ GitHub
4. é€‰æ‹© `musication-backend` ä»“åº“

#### 2. æ·»åŠ  PostgreSQL æ•°æ®åº“

1. åœ¨é¡¹ç›®ä¸­ç‚¹å‡» "+ New"
2. é€‰æ‹© "Database" â†’ "PostgreSQL"
3. Railway ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“å¹¶æä¾›è¿žæŽ¥ä¿¡æ¯

#### 3. é…ç½®çŽ¯å¢ƒå˜é‡

åœ¨åŽç«¯æœåŠ¡çš„ "Variables" æ ‡ç­¾ä¸­æ·»åŠ ï¼š

**å¿…éœ€çš„çŽ¯å¢ƒå˜é‡ï¼š**
```bash
# Railway è‡ªåŠ¨æä¾›çš„å˜é‡ï¼ˆæ— éœ€æ‰‹åŠ¨è®¾ç½®ï¼‰ï¼š
# - PORT (è‡ªåŠ¨æ³¨å…¥)
# - DATABASE_URL (è¿žæŽ¥åˆ°ä½ çš„ PostgreSQL)

# éœ€è¦æ‰‹åŠ¨è®¾ç½®çš„å˜é‡ï¼š
FLASK_ENV=production

# åŽç«¯å…¬å¼€ URLï¼ˆéƒ¨ç½²åŽèŽ·å–ï¼‰
BASE_URL=https://your-backend-url.up.railway.app

# å‰ç«¯ URLï¼ˆç”¨äºŽ CORSï¼‰
FRONTEND_URL=https://your-frontend-url.netlify.app

# å¯é€‰ï¼šå†…å­˜ä¼˜åŒ–é€‰é¡¹
ENABLE_MELODY_ANALYSIS=false
```

**å¦‚ä½•èŽ·å– BASE_URLï¼š**
- éƒ¨ç½²æˆåŠŸåŽï¼ŒRailway ä¼šç”Ÿæˆä¸€ä¸ªå…¬å¼€åŸŸå
- æ ¼å¼ç±»ä¼¼ï¼š`https://musication-backend-production.up.railway.app`
- å¤åˆ¶è¿™ä¸ª URL å¹¶è®¾ç½®ä¸º `BASE_URL`

#### 4. è®¾ç½®æ ¹ç›®å½•ï¼ˆå¦‚æžœæ˜¯ monorepoï¼‰

å¦‚æžœä½ çš„ä»“åº“åŒ…å«å‰ç«¯å’ŒåŽç«¯ï¼š
1. è¿›å…¥æœåŠ¡è®¾ç½® (Settings)
2. æ‰¾åˆ° "Root Directory"
3. è®¾ç½®ä¸º `musication-backend`

#### 5. è§¦å‘éƒ¨ç½²

- Railway ä¼šè‡ªåŠ¨æ£€æµ‹åˆ° `Dockerfile` å¹¶å¼€å§‹æž„å»º
- é¦–æ¬¡éƒ¨ç½²å¯èƒ½éœ€è¦ 3-5 åˆ†é’Ÿ
- æŸ¥çœ‹ "Deployments" æ ‡ç­¾ç›‘æŽ§è¿›åº¦

### ä¸‰ã€é…ç½®åŸŸåï¼ˆå¯é€‰ï¼‰

1. åœ¨æœåŠ¡çš„ "Settings" â†’ "Networking"
2. Railway æä¾›å…è´¹å­åŸŸåï¼š`*.up.railway.app`
3. ä¹Ÿå¯ä»¥ç»‘å®šè‡ªå®šä¹‰åŸŸå

### å››ã€æ›´æ–°å‰ç«¯é…ç½®

æ›´æ–° `musication-frontend` çš„çŽ¯å¢ƒå˜é‡ï¼š

**Netlifyï¼š**
1. è¿›å…¥ Site settings â†’ Environment variables
2. æ›´æ–° `NEXT_PUBLIC_API_URL` ä¸º Railway åŽç«¯ URL
3. è§¦å‘é‡æ–°éƒ¨ç½²

**æˆ–è¿ç§»åˆ° Vercelï¼š**
1. åœ¨ Vercel å¯¼å…¥é¡¹ç›®
2. è®¾ç½®çŽ¯å¢ƒå˜é‡ï¼š
   ```
   NEXT_PUBLIC_API_URL=https://your-backend.up.railway.app
   ```
3. éƒ¨ç½²

### äº”ã€æ•°æ®åº“åˆå§‹åŒ–

Railway PostgreSQL ä¼šè‡ªåŠ¨åˆå§‹åŒ–ï¼Œä½†ä½ éœ€è¦ç¡®ä¿ï¼š

1. **æ•°æ®åº“æ‰©å±•å·²å¯ç”¨**
   - Railway çš„ PostgreSQL é»˜è®¤æ”¯æŒ `uuid-ossp` æ‰©å±•
   - ä½ çš„ä»£ç ä¼šè‡ªåŠ¨åˆ›å»ºè¡¨ç»“æž„ï¼ˆé€šè¿‡ `app.py` ç¬¬ 53-54 è¡Œï¼‰

2. **éªŒè¯æ•°æ®åº“è¿žæŽ¥**
   - æŸ¥çœ‹åŽç«¯æœåŠ¡æ—¥å¿—
   - è®¿é—® `https://your-backend.up.railway.app/health`
   - åº”è¯¥è¿”å›ž `{"status": "ok"}`

### å…­ã€å¸¸è§é—®é¢˜æŽ’æŸ¥

#### é—®é¢˜ 1: éƒ¨ç½²è¶…æ—¶
**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥ `Dockerfile` ä¸­çš„ä¾èµ–å®‰è£…
- ç¡®ä¿ `requirements.txt` æ²¡æœ‰ä¸å¿…è¦çš„å¤§åž‹åŒ…

#### é—®é¢˜ 2: å†…å­˜ä¸è¶³ (OOM)
**è§£å†³æ–¹æ¡ˆï¼š**
- è®¾ç½® `ENABLE_MELODY_ANALYSIS=false`
- æ£€æŸ¥æ˜¯å¦æœ‰å†…å­˜æ³„æ¼
- è€ƒè™‘å‡çº§ Railway è®¡åˆ’

#### é—®é¢˜ 3: æ•°æ®åº“è¿žæŽ¥å¤±è´¥
**è§£å†³æ–¹æ¡ˆï¼š**
- ç¡®è®¤ `DATABASE_URL` çŽ¯å¢ƒå˜é‡å­˜åœ¨
- æ£€æŸ¥ Railway PostgreSQL æœåŠ¡æ˜¯å¦åœ¨è¿è¡Œ
- æŸ¥çœ‹æœåŠ¡æ—¥å¿—èŽ·å–è¯¦ç»†é”™è¯¯

#### é—®é¢˜ 4: CORS é”™è¯¯
**è§£å†³æ–¹æ¡ˆï¼š**
- ç¡®ä¿ `FRONTEND_URL` çŽ¯å¢ƒå˜é‡è®¾ç½®æ­£ç¡®
- æ£€æŸ¥å‰ç«¯çš„ API URL é…ç½®
- æŸ¥çœ‹åŽç«¯æ—¥å¿—ä¸­çš„ CORS é…ç½®

### ä¸ƒã€ç›‘æŽ§å’Œæ—¥å¿—

**æŸ¥çœ‹æ—¥å¿—ï¼š**
1. åœ¨ Railway Dashboard ä¸­é€‰æ‹©æœåŠ¡
2. ç‚¹å‡» "Deployments" æ ‡ç­¾
3. é€‰æ‹©æœ€æ–°çš„éƒ¨ç½²æŸ¥çœ‹å®žæ—¶æ—¥å¿—

**ç›‘æŽ§èµ„æºä½¿ç”¨ï¼š**
1. "Metrics" æ ‡ç­¾æ˜¾ç¤º CPU/å†…å­˜/ç½‘ç»œä½¿ç”¨æƒ…å†µ
2. å…è´¹å±‚é™åˆ¶ï¼š
   - å†…å­˜ï¼š8GB
   - CPUï¼šå…±äº«
   - ç½‘ç»œï¼š100GB/æœˆ

### å…«ã€æˆæœ¬ä¼°ç®—

**Railway å®šä»·ï¼ˆ2024ï¼‰ï¼š**
- å…è´¹é¢åº¦ï¼š$5/æœˆ
- è¶…å‡ºåŽæŒ‰ä½¿ç”¨é‡è®¡è´¹
- PostgreSQLï¼šçº¦ $5-10/æœˆ
- Web Serviceï¼šçº¦ $5-10/æœˆï¼ˆå–å†³äºŽä½¿ç”¨é‡ï¼‰

**é¢„è®¡æ€»æˆæœ¬ï¼š**
- å‰ 500 å°æ—¶å…è´¹
- ä¹‹åŽçº¦ $10-15/æœˆï¼ˆè½»åº¦ä½¿ç”¨ï¼‰

### ä¹ã€è‡ªåŠ¨éƒ¨ç½²

Railway æ”¯æŒ GitHub é›†æˆï¼š
1. æŽ¨é€åˆ° `main` åˆ†æ”¯è‡ªåŠ¨è§¦å‘éƒ¨ç½²
2. PR é¢„è§ˆçŽ¯å¢ƒï¼ˆéœ€è¦é…ç½®ï¼‰
3. å›žæ»šåˆ°ä¹‹å‰çš„éƒ¨ç½²ç‰ˆæœ¬

---

## ðŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

åœ¨éƒ¨ç½²å‰ç¡®è®¤ï¼š

- [ ] GitHub ä»“åº“å·²è¿žæŽ¥åˆ° Railway
- [ ] PostgreSQL æ•°æ®åº“å·²åˆ›å»º
- [ ] çŽ¯å¢ƒå˜é‡å·²å…¨éƒ¨è®¾ç½®
- [ ] Dockerfile å­˜åœ¨ä¸”é…ç½®æ­£ç¡®
- [ ] å‰ç«¯ API URL å·²æ›´æ–°
- [ ] æµ‹è¯• `/health` ç«¯ç‚¹
- [ ] æµ‹è¯•æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
- [ ] æµ‹è¯•éŸ³ä¹è¯†åˆ«åŠŸèƒ½
- [ ] æµ‹è¯•ç›¸ä¼¼åº¦å¯¹æ¯”åŠŸèƒ½

---

## ðŸ”„ ä»Ž Render è¿ç§»

å¦‚æžœä½ å½“å‰åœ¨ Render ä¸Šè¿è¡Œï¼š

1. **å¯¼å‡ºæ•°æ®ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰ï¼š**
   ```bash
   # ä»Ž Render PostgreSQL å¯¼å‡º
   pg_dump $RENDER_DATABASE_URL > backup.sql
   
   # å¯¼å…¥åˆ° Railway PostgreSQL
   psql $RAILWAY_DATABASE_URL < backup.sql
   ```

2. **æ›´æ–° DNS/åŸŸå**
   - å¦‚æžœä½¿ç”¨è‡ªå®šä¹‰åŸŸåï¼Œæ›´æ–° DNS è®°å½•æŒ‡å‘ Railway

3. **å…³é—­ Render æœåŠ¡**
   - ç¡®è®¤ Railway è¿è¡Œæ­£å¸¸åŽå†å…³é—­
   - é¿å…åŒæ—¶è¿è¡Œä¸¤ä¸ªå®žä¾‹å¯¼è‡´æ•°æ®ä¸ä¸€è‡´

---

## ðŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

- Railway æ–‡æ¡£: https://docs.railway.app/
- Railway Discord: https://discord.gg/railway
- æœ¬é¡¹ç›® Issues: [ä½ çš„ GitHub repo URL]
